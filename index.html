<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Atrapa la Moneda 2.0</title>

<style>
body{
  margin:0;
  background:#111;
  color:white;
  font-family:Arial;
  text-align:center;
  overflow:hidden;
}

h1{
  color:#00ffcc;
  text-shadow:0 0 15px #00ffcc;
}

button{
  padding:12px 25px;
  margin:8px;
  font-size:18px;
  background:#00ffcc;
  border:none;
  border-radius:10px;
  cursor:pointer;
}

#game,#config{
  display:none;
}

#zona{
  position:relative;
  width:100%;
  height:300px;
  overflow:hidden;
  margin-top:20px;
  border-top:2px solid #00ffcc;
}

#moneda{
  position:absolute;
  font-size:70px;
}

#botones{
  position:fixed;
  bottom:20px;
  width:100%;
  display:flex;
  justify-content:space-around;
}

#botones button{
  width:90px;
  height:90px;
  font-size:28px;
  border-radius:20px;
}

select{
  padding:8px;
  font-size:16px;
}
</style>
</head>
<body>

<h1>ðŸŽ® ATRAPA LA MONEDA 2.0</h1>

<div id="menu">
  <button onclick="iniciar()">INICIAR</button>
  <button onclick="abrirConfig()">CONFIGURACIÃ“N</button>
</div>

<div id="config">
  <h2>âš™ ConfiguraciÃ³n</h2>

  <p>ðŸ”Š Sonido:
    <select id="sonidoOpt">
      <option value="true">Activado</option>
      <option value="false">Desactivado</option>
    </select>
  </p>

  <p>ðŸ“³ VibraciÃ³n:
    <select id="vibracionOpt">
      <option value="true">Activada</option>
      <option value="false">Desactivada</option>
    </select>
  </p>

  <p>âš¡ Dificultad:
    <select id="dificultadOpt">
      <option value="facil">FÃ¡cil</option>
      <option value="normal">Normal</option>
      <option value="extremo">Extremo</option>
    </select>
  </p>

  <button onclick="guardarConfig()">Guardar</button>
  <button onclick="cerrarConfig()">Volver</button>
</div>

<div id="game">

  <div id="zona">
    <div id="moneda">ðŸª™</div>
  </div>

  <div id="stats"></div>

  <div id="botones">
    <button onclick="respuesta('L')">L</button>
    <button onclick="respuesta('C')">C</button>
    <button onclick="respuesta('R')">R</button>
  </div>

</div>

<script>

let pesos = 0;
let vidas = 5;
let velocidadBase = 2;
let velocidadCaida = 2;
let monedaActual = "";
let y = -80;
let animacion;
let audioContext;

let config = {
  sonido: true,
  vibracion: true,
  dificultad: "normal"
};

const monedaEl = document.getElementById("moneda");
const statsEl = document.getElementById("stats");

let posiciones = ["L","C","R"];

cargarConfig();

function iniciar(){
  aplicarDificultad();
  document.getElementById("menu").style.display="none";
  document.getElementById("game").style.display="block";
  resetGame();
}

function resetGame(){
  pesos = 0;
  vidas = 5;
  velocidadCaida = velocidadBase;
  nuevaMoneda();
  actualizarStats();
}

function nuevaMoneda(){
  monedaActual = posiciones[Math.floor(Math.random()*3)];
  let posX = {L:"15%",C:"45%",R:"75%"};
  monedaEl.style.left = posX[monedaActual];

  y = -80;
  monedaEl.style.top = y+"px";

  cancelAnimationFrame(animacion);
  animacion = requestAnimationFrame(caer);
}

function caer(){
  y += velocidadCaida;
  monedaEl.style.top = y+"px";

  if(y > 250){
    perderVida();
    return;
  }

  animacion = requestAnimationFrame(caer);
}

function respuesta(eleccion){

  if(eleccion === monedaActual){
    cancelAnimationFrame(animacion);
    pesos++;
    velocidadCaida += 0.3;

    if(config.sonido) sonidoAcierto();
    nuevaMoneda();
  }else{
    perderVida();
  }

  actualizarStats();
}

function perderVida(){
  cancelAnimationFrame(animacion);
  vidas--;

  if(config.sonido) sonidoError();
  if(config.vibracion && navigator.vibrate){
    navigator.vibrate(200);
  }

  if(vidas <= 0){
    alert("GAME OVER\nPuntaje: "+pesos);
    document.getElementById("game").style.display="none";
    document.getElementById("menu").style.display="block";
  }else{
    nuevaMoneda();
  }

  actualizarStats();
}

function actualizarStats(){
  statsEl.innerText = "Pesos: "+pesos+" | Vidas: "+vidas;
}

function sonidoAcierto(){
  initAudio();
  const osc = audioContext.createOscillator();
  const gain = audioContext.createGain();
  osc.type="square";
  osc.frequency.value=700;
  gain.gain.value=0.1;
  osc.connect(gain);
  gain.connect(audioContext.destination);
  osc.start();
  osc.stop(audioContext.currentTime+0.2);
}

function sonidoError(){
  initAudio();
  const osc = audioContext.createOscillator();
  const gain = audioContext.createGain();
  osc.type="sawtooth";
  osc.frequency.value=200;
  gain.gain.value=0.1;
  osc.connect(gain);
  gain.connect(audioContext.destination);
  osc.start();
  osc.stop(audioContext.currentTime+0.3);
}

function initAudio(){
  if(!audioContext){
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
  }
}

function abrirConfig(){
  document.getElementById("menu").style.display="none";
  document.getElementById("config").style.display="block";
}

function cerrarConfig(){
  document.getElementById("config").style.display="none";
  document.getElementById("menu").style.display="block";
}

function guardarConfig(){
  config.sonido = document.getElementById("sonidoOpt").value==="true";
  config.vibracion = document.getElementById("vibracionOpt").value==="true";
  config.dificultad = document.getElementById("dificultadOpt").value;

  localStorage.setItem("configJuego", JSON.stringify(config));
  aplicarDificultad();
  cerrarConfig();
}

function cargarConfig(){
  let guardado = localStorage.getItem("configJuego");
  if(guardado){
    config = JSON.parse(guardado);
  }
}

function aplicarDificultad(){
  if(config.dificultad==="facil"){
    velocidadBase=1.5;
  }
  if(config.dificultad==="normal"){
    velocidadBase=2;
  }
  if(config.dificultad==="extremo"){
    velocidadBase=3.5;
  }
}

document.addEventListener("keydown",function(e){
  const t=e.key.toUpperCase();
  if(["L","C","R"].includes(t)){
    respuesta(t);
  }
});

</script>
</body>
</html>
