<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Atrapa la Moneda - Mega Update</title>
<style>
body { margin:0; background:#0f0f0f; color:white; font-family:Arial; text-align:center; }
h1 { color:#00ffcc; text-shadow:0 0 10px #00ffcc; }
#game { margin-top:20px; }
#moneda { font-size:80px; margin:20px; }
.info { font-size:20px; margin:10px; }
/* Chat */
#chatContainer{
  position:fixed; bottom:10px; right:10px; width:260px; max-height:320px;
  background:rgba(0,0,0,0.7); border:2px solid #00ffcc; border-radius:10px;
  padding:5px; display:flex; flex-direction:column; z-index:1000;
}
#chatMessages{ flex:1; overflow-y:auto; padding:5px; border-bottom:1px solid #00ffcc; margin-bottom:5px; }
#chatInput{ width:calc(100% - 60px); padding:5px; border:none; border-radius:5px; margin-right:5px; }
#sendBtn{ width:50px; background:#00ffcc; border:none; border-radius:5px; cursor:pointer; font-weight:bold; }
.chatMsg{ margin:2px 0; }
.chatMsg.user{ color:#ffff66; }
.chatMsg.owner{ color:#ff88ff; font-weight:bold; }
</style>
</head>
<body>

<h1>üéÆ ATRAPA LA MONEDA - MEGA UPDATE</h1>

<div id="game">
  <h2 id="moneda">‚ùì</h2>
  <p>Presiona L, C o R</p>
  <div class="info" id="stats"></div>
</div>

<!-- Chat -->
<div id="chatContainer">
  <div id="chatMessages"></div>
  <input type="text" id="chatInput" placeholder="Escribe un mensaje..." />
  <button id="sendBtn">Enviar</button>
</div>

<script>
// ---------------- Juego ----------------
let pesos=0, vidas=5, record=localStorage.getItem("record")||0;
let secuencia=["R","L","C","L","R","C","R"];
let indice=0;
let monedaActual="";
let velocidad=1500;
let intervalo;

const monedaEl=document.getElementById("moneda");
const statsEl=document.getElementById("stats");

function resetGame(){
  pesos=0; vidas=5; velocidad=1500; indice=0;
  actualizarStats();
  nuevaMoneda();
  clearInterval(intervalo);
  intervalo=setInterval(tiempoAgotado,velocidad);
}
resetGame();

function nuevaMoneda(){
  monedaActual=secuencia[indice];
  monedaEl.innerText=monedaActual;
  indice++; if(indice>=secuencia.length) indice=0;
}

function actualizarStats(){
  statsEl.innerText="Pesos: "+pesos+" | Vidas: "+vidas+" | R√©cord: "+record;
}

function tiempoAgotado(){
  vidas--; actualizarStats();
  if(vidas<=0) gameOver();
  nuevaMoneda();
}

function gameOver(){
  clearInterval(intervalo);
  if(pesos>record){ record=pesos; localStorage.setItem("record",record);}
  alert("GAME OVER\nPuntaje: "+pesos);
  resetGame();
}

document.addEventListener("keydown", function(e){
  const eleccion=e.key.toUpperCase();
  if(!["L","C","R"].includes(eleccion)) return;
  if(eleccion===monedaActual){
    pesos++;
    velocidad-=50;
    if(velocidad<500) velocidad=500;
    clearInterval(intervalo);
    intervalo=setInterval(tiempoAgotado,velocidad);
  } else { vidas--; }
  actualizarStats();
  if(vidas<=0) gameOver();
  nuevaMoneda();
});

// ---------------- Chat ----------------
let chatHistory=[];
const chatMessages=document.getElementById("chatMessages");
const chatInput=document.getElementById("chatInput");
const sendBtn=document.getElementById("sendBtn");

function sendChat(){
  const msg=chatInput.value.trim();
  if(!msg) return;
  addMessage("user",msg);
  chatInput.value="";
}

function ownerSend(msg){
  addMessage("owner",msg);
}

function addMessage(from,text){
  if(chatHistory.length>=20) chatHistory.shift();
  chatHistory.push({from,text});
  updateChat();
}

function updateChat(){
  chatMessages.innerHTML="";
  chatHistory.forEach(m=>{
    const div=document.createElement("div");
    div.className="chatMsg "+m.from;
    div.innerText=(m.from==="owner"?"Owner: ":"Jugador: ")+m.text;
    chatMessages.appendChild(div);
  });
  chatMessages.scrollTop=chatMessages.scrollHeight;
}

chatInput.addEventListener("keydown",function(e){
  if(e.key==="Enter") sendChat();
});
sendBtn.addEventListener("click",sendChat);

// ---------------- Comandos Owner ----------------
const ownerPassword="ruler123"; // cambia a tu contrase√±a
let isOwner=false;

function loginOwner(pw){
  if(pw===ownerPassword){
    isOwner=true;
    ownerSend("¬°Owner conectado!");
    alert("Modo Owner activado");
  } else { alert("Contrase√±a incorrecta"); }
}

// Comandos antiguos y nuevos
function giveCoins(n){
  if(!isOwner) return;
  pesos+=n;
  actualizarStats();
  ownerSend("Se han agregado "+n+" monedas!");
}

function infiniteLives(){
  if(!isOwner) return;
  vidas=9999;
  actualizarStats();
  ownerSend("Vidas infinitas activadas!");
}

function triggerEvent(eventName){
  if(!isOwner) return;
  switch(eventName){
    case "rainDiamonds":
      pesos+=10;
      actualizarStats();
      ownerSend("Evento Rain Diamonds activado! +10 monedas");
      break;
    default:
      ownerSend("Evento desconocido: "+eventName);
  }
}

// ---------------- Funciones antiguas preservadas ----------------
// Puedes agregar m√°s funciones antiguas aqu√≠, solo para owner
// Por ejemplo: comandos de party, clear monedas, eventos legacy
// Legacy:
// function partyEvent(){...}
// function clearCoins(){...}
</script>

</body>
</html>
